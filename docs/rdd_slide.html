<!DOCTYPE html>
<html lang="ja"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.33">

  <meta name="author" content="宋財泫（関西大学）">
  <title>困菓唯倫 with R – 社会科学における因果推論</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-8959375eb0f6913aa26bd5e18886ba7d.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">社会科学における因果推論</h1>
  <p class="subtitle">9/ 回帰不連続デザイン</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
宋財泫（関西大学） 
</div>
</div>
</div>

</section>
<section>
<section id="rddとは" class="title-slide slide level1 center">
<h1><strong>1</strong> RDDとは</h1>

</section>
<section id="比例性と投票参加" class="slide level2">
<h2>比例性と投票参加</h2>
<ul>
<li>合理的有権者の投票参加モデル（<a href="https://doi.org/10.2307/1953324">Riker and Ordeshook 1968</a>）
<ul>
<li><span class="math inline">\(R = P \cdot B - C + D\)</span>（<span class="math inline">\(R \leq 0\)</span>の場合、棄権）</li>
<li>有権者は自分の持つ一票の価値（<span class="math inline">\(P\)</span>）が低いと、棄権しやすい。</li>
</ul></li>
<li>比例性が高い = 自分の一票が議席に変換される確率が高い = 死票が少ない</li>
<li><span class="math inline">\(\Rightarrow\)</span> 比例代表制は投票率を上げる？</li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-4-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="群間単純比較" class="slide level2">
<h2>群間単純比較</h2>
<ul>
<li>多数代表制の国が比例代表制を採用すると投票率が2.8%p増加する?
<ul>
<li>比例代表制を採用する国の平均投票率：65.3%</li>
<li>多数代表制を採用する国の平均投票率：62.5%</li>
</ul></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-5-1.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>平均値の単純比較の限界
<ul>
<li>誤差項には政治文化、歴史、経済状況、社会内の対立軸、周辺国の制度、支配国の制度等が含まれる。</li>
<li>これらの要因の一部は交絡要因と考えられるため、単純比較から得られた推定値はバイアスを含む。</li>
<li>国固有の文脈（context）により単純比較は困難</li>
<li><span class="math inline">\(\Rightarrow\)</span> 一国内で異なる選挙制度があれば?</li>
</ul></li>
</ul>
</div></div>
</section>
<section id="フランスの例" class="slide level2">
<h2>フランスの例</h2>
<ul>
<li>コミューン<sup>1</sup>（<em>commune</em>）議会選挙（1982〜2013<sup>2</sup>）
<ul>
<li>人口3500人未満のコミューン：多数代表制（大選挙区制）</li>
<li>人口3500人以上のコミューン：比例代表制（プレミアム付）</li>
<li>以下は架空のデータ（実際の研究成果は<a href="https://doi.org/10.1177/0010414014534199">Eggers[2014]</a>等を参照）</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center" width="2400"></p>
</figure>
</div>
</div>
</div>

<aside><div>
<p>Eggers, Andrew C.. 2014. “<a href="https://doi.org/10.1177/0010414014534199">Proportionality and Turnout: Evidence From French Municipalities</a>.” <em>Comparative Political Studies,</em> 48(2): 135-167.</p>
</div><ol class="aside-footnotes"><li id="fn1"><p>フランスにおける基礎自治体の最小単位であり、2025年現在、約35,000コミューンが存在する。</p></li><li id="fn2"><p>2013年の法改正により閾値が1000人へ引き下げ（2014年選挙から適用）</p></li></ol></aside></section>
<section id="内生性は" class="slide level2">
<h2>内生性は?</h2>
<p>交絡要因の存在により、群間の単純比較では信頼できる処置効果の推定が不可能</p>
<ul>
<li>バックドア経路が存在（D <span class="math inline">\(\leftarrow\)</span> R <span class="math inline">\(\rightarrow\)</span> W <span class="math inline">\(\rightarrow\)</span> Y）</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>Y：投票率</li>
<li>D：選挙制度</li>
<li>R：人口</li>
<li>W：都市化度</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center" width="1800"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="選挙制度がランダムに" class="slide level2">
<h2>選挙制度がランダムに?</h2>
<ul>
<li>人口が3500人周辺であれば、都市化度はほぼ同じだと考えられる。
<ul>
<li>人口3400人のコミューンと3600人のコミューンの都市化度は「ほぼ」同じであり、人口が3500人を超えるかどうかは「<span class="alert"><strong>運</strong></span>」とも言える。</li>
<li><span class="math inline">\(\leadsto\)</span> 内生性の原因（の一つ）である「都市化度」がコントロールされる。</li>
<li><span class="math inline">\(\leadsto\)</span> 区間内において、選挙制度は<span class="alert">「ほぼ」ランダム</span>に決まる（<span class="math inline">\(\fallingdotseq\)</span>実験？）。</li>
</ul></li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-10-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="回帰不連続デザイン" class="slide level2">
<h2>回帰不連続デザイン</h2>
<ul>
<li><strong>R</strong>egression <strong>D</strong>iscontinuity <strong>D</strong>esign（<span class="alert"><strong>RDD</strong></span>）
<ul>
<li>参考：<a href="https://doi.org/10.1037/h0044319">Thistlethwaite and Campbell（1960）</a></li>
</ul></li>
<li>観測された共変量の値が（制度等によって決められた）閾値のいずれかの側にあるかによって、処置の割り当てが決まる。
<ul>
<li>「観測された共変量」は<span class="alert"><strong>割当変数</strong></span>（Running variable）、または<span class="alert"><strong>強制変数</strong></span>（Forcing variable）と呼ばれる。</li>
<li>割当変数（<span class="math inline">\(R_i\)</span>）の値が閾値（<span class="math inline">\(c\)</span>）を超えた個体を「処置群（<span class="math inline">\(D_i = 1\)</span>）」と呼ぶケースが多い。</li>
</ul></li>
</ul>
<p><span class="math display">\[
D_i = \begin{cases}
0 &amp; \textsf{if} &amp; R_i &lt; c \\
1 &amp; \textsf{if} &amp; R_i \geq c
\end{cases}
\]</span></p>
<ul>
<li>推定対象（estimand）はATEでなく、<span class="alert"><strong>LATE</strong></span>（Local ATE; <strong>局所平均処置効果</strong>）</li>
</ul>
</section>
<section id="なぜ不連続か" class="slide level2">
<h2>なぜ「不連続」か</h2>
<ul>
<li>回帰直線が上方向（または、下方向）に<span class="alert"><strong>ジャンプ</strong></span>
<ul>
<li>ジャンプの幅が<strong>LATE</strong></li>
</ul></li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="つのrdd" class="slide level2">
<h2>2つのRDD</h2>
<p>異なる割当メカニズムを想定した2つのRDD（本講義ではSRDのみ解説）</p>
<ol type="1">
<li><strong><span class="alert">Sharp</span> Regression Discontinuity</strong> (SRD)
<ul>
<li>割当変数の値が閾値を超えると<strong>必ず</strong>処置を受ける。</li>
<li>例) 人口と選挙制度</li>
</ul></li>
<li><strong><span class="alert">Fuzzy</span> Regression Discontinuity</strong> (FRD)
<ul>
<li>割当変数の値が閾値を超えると処置を受ける<strong>確率</strong>がジャンプする。</li>
<li>例) 入試</li>
</ul></li>
</ol>
</section>
<section id="割当メカニズムの比較" class="slide level2">
<h2>割当メカニズムの比較</h2>
<p>割当変数の値が閾値を超えると、処置を受ける確率が<strong>ジャンプ</strong>する。</p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-12-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section></section>
<section>
<section id="仮定" class="title-slide slide level1 center">
<h1><strong>2</strong> 仮定</h1>

</section>
<section id="rddの仮定識別条件" class="slide level2">
<h2>RDDの仮定（識別条件）</h2>
<ol type="1">
<li>閾値のルールが明確であり、既知であること
<ul>
<li>RDDの場合、閾値は制度に起因するものが多いため、これが問題になるケースは少ない。</li>
</ul></li>
</ol>
<ul>
<li>閾値周辺において…
<ol start="2" type="1">
<li>潜在的結果が連続であること</li>
<li>結果変数に影響を与える共変量（処置変数を除く）が連続すること</li>
<li>割当変数が連続であること</li>
</ol></li>
</ul>
</section>
<section id="潜在的結果の連続性" class="slide level2">
<h2>潜在的結果の連続性</h2>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="共変量の連続性" class="slide level2">
<h2>共変量の連続性</h2>
<ul>
<li>結果変数に影響を与える変数が閾値周辺で変化しないこと
<ul>
<li>架空の例）21歳になれば…
<ol type="1">
<li><span class="alert"><strong>識別可能</strong></span>：飲酒ができるようになり、他は何も変わらない。</li>
<li><span class="alert"><strong>識別不可</strong></span>：飲酒だけでなく、運転も、宜しくない薬も、結婚もできるようになる。</li>
</ol></li>
</ul></li>
<li>共変量が揃っていれば（限定的ではあるが）バランスチェックで確認可能</li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-14-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="割当変数の連続性" class="slide level2">
<h2>割当変数の連続性</h2>
<ul>
<li>閾値周辺において強制変数の操作が行われていないこと</li>
<li><a href="https://doi.org/10.1016/j.jeconom.2007.05.005">McCrary（2008）</a>の密度検定（density test）で仮定違反有無が確認可能</li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-15-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section></section>
<section>
<section id="推定" class="title-slide slide level1 center">
<h1><strong>3</strong> 推定</h1>

</section>
<section id="推定方法" class="slide level2">
<h2>推定方法</h2>
<ul>
<li>パラメトリック（parametric）推定</li>
<li>ノンパラメトリック（non-parametric）推定
<ul>
<li>局所平均</li>
<li>局所回帰</li>
</ul></li>
</ul>
</section>
<section id="パラメトリック推定" class="slide level2">
<h2>パラメトリック推定</h2>
<p><span class="alert"><strong>結果変数を処置変数と割当変数に回帰した（非）線形回帰モデル</strong></span></p>
<div class="columns">
<div class="column" style="width:55%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<p><span class="math display">\[
\hat{Y_i} = \alpha + \textcolor{red}{\rho} D_i + \beta R_i
\]</span></p>
<ul>
<li><p><span class="math inline">\(Y_i\)</span>：結果変数</p></li>
<li><p><span class="math inline">\(D_i\)</span>：処置変数（<span class="math inline">\(D_i \in \{0, 1\}\)</span>）</p></li>
<li><p><span class="math inline">\(R_i\)</span>：割当変数</p></li>
<li><p><span class="math inline">\(\rho\)</span>：<span class="alert"><strong>局所処置効果（LATE）</strong></span></p></li>
</ul>
</div></div>
</section>
<section id="交互作用" class="slide level2">
<h2>交互作用</h2>
<p>閾値を超えることによって回帰直線の傾きが変化すると考えられる場合</p>
<ul>
<li>処置変数と割当変数の交差項を投入</li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="交互作用の注意点" class="slide level2">
<h2>交互作用の注意点</h2>
<p><span class="math display">\[
\hat{Y_i} = \alpha + \rho D_i + \beta R_i + \gamma D_i \cdot R_i
\]</span></p>
<ul>
<li>この場合、LATEは<span class="math inline">\(\rho\)</span><strong>ではなく</strong>、<span class="math inline">\(\rho + \gamma \cdot c\)</span>
<ul>
<li>処置効果は<span class="math inline">\(R_i\)</span>の値に依存<sup>1</sup>（処置効果は<span class="math inline">\(R_i = c\)</span>の箇所のみで観察されるため）</li>
</ul></li>
<li>閾値（<span class="math inline">\(c\)</span>）が0になるように割当変数を調整（=<span class="alert">割当変数を閾値で<strong>中心化</strong></span>）することを推奨
<ul>
<li>割当変数の値から閾値を値を引くだけで十分</li>
</ul></li>
<li>割当変数を<span class="math inline">\(c\)</span>で中心化すると、新しい<span class="math inline">\(c\)</span>は必ず0
<ul>
<li>LATEは<span class="math inline">\(\rho + \gamma \cdot 0\)</span> = <span class="math inline">\(\rho\)</span></li>
</ul></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn3"><p>なぜこうなるのかが分からない場合は、本講義の履修よりも先に交互作用の解釈について勉強すること。交互作用の解釈に関する解説は<a href="https://doi.org/10.1093/pan/mpi014">Brambor（2006）</a>が詳しい。まだ読んだことない人にもおすすめできる論文だ。</p></li></ol></aside></section>
<section id="中心化の前後比較" class="slide level2">
<h2>中心化の前後比較</h2>
<p><span class="math display">\[
\hat{Y_i} = \alpha + \rho D_i + \beta R_i + \gamma D_i \cdot R_i
\]</span></p>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-18-1.png" class="quarto-figure quarto-figure-center" width="1200"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-18-2.png" class="quarto-figure quarto-figure-center" width="1200"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="非線形の場合" class="slide level2">
<h2>非線形の場合</h2>
<ul>
<li>割当変数の2乗項、3乗項、…を投入（<span class="alert">交互作用と組み合わせる場合</span>）</li>
</ul>
<p><span class="math display">\[
\begin{align}
\hat{Y_i} = &amp; \alpha + \rho D_i + \beta_1 R_i + \beta_2 R_i^2 + ... + \beta_k R_i^k \textcolor{#E82825}{+} \\
&amp; \textcolor{#E82825}{\gamma_1 (D_i \cdot R_i) + \gamma_2 (D_i \cdot R_i^2) + ... + \gamma_k (D_i \cdot R_i^k)}
\end{align}
\]</span></p>
<ul>
<li>モデル選択の基準の例：<span class="math inline">\(F\)</span>検定、AIC、BIC、…</li>
<li>しかし、高次多項式は推奨されない（<a href="https://doi.org/10.1080/07350015.2017.1366909">Gelman and Imbens 2018</a>）
<ul>
<li>高次項を入れるとバイアスは小さくなるが、分散が大きくなる。
<ul>
<li>そもそもRDDにおいてフィットの良さは重要ではない。</li>
</ul></li>
<li><a href="https://doi.org/10.1080/07350015.2017.1366909">Gelman and Imbens（2018）</a>は局所回帰、または二次多項式までを推奨</li>
</ul></li>
</ul>

<aside><div>
<p>Gelman, Andrew and Guido Imbens. 2018. “<a href="https://doi.org/10.1080/07350015.2017.1366909">Why High-Order Polynomials Should Not Be Used in Regression Discontinuity Designs</a>.” <em>Journal of Business &amp; Economic Statistics,</em> 37(3): 447-456.</p>
</div></aside></section>
<section id="線形か非線形か" class="slide level2">
<h2>線形か非線形か</h2>
<p>実は閾値周辺で連続する関数（<span class="math inline">\(Y = \frac{1}{1 + e^{-R}}\)</span>）だが…</p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="次関数の例" class="slide level2">
<h2>1次関数の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \beta R_i + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-21-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数-交差項の例" class="slide level2">
<h2>1次関数 + 交差項の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \beta R_i + \gamma D_i \cdot R_i + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-22-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数の例-1" class="slide level2">
<h2>2次関数の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \beta_1 R_i + \beta_1 R_i^2 + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数-交差項の例-1" class="slide level2">
<h2>2次関数 + 交差項の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \beta_1 R_i + \beta_1 R_i^2 + \gamma_1 D_i \cdot R_i + \gamma_1 D_i \cdot R_i^2 + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-24-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数の例-2" class="slide level2">
<h2>3次関数の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^3 \beta_j R_i^j + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-25-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数-交差項の例-2" class="slide level2">
<h2>3次関数 + 交差項の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^3 \beta_j R_i^j + \sum_{k=1}^3 \gamma_k D_i \cdot R_i^k + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-26-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数の例-3" class="slide level2">
<h2>4次関数の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^4 \beta_j R_i^j + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-27-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数-交差項の例-3" class="slide level2">
<h2>4次関数 + 交差項の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^4 \beta_j R_i^j + \sum_{k=1}^4 \gamma_k D_i \cdot R_i^k + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-28-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数の例-4" class="slide level2">
<h2>5次関数の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^5 \beta_j R_i^j + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-29-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="次関数-交差項の例-4" class="slide level2">
<h2>5次関数 + 交差項の例</h2>
<p><span class="math inline">\(Y_i = \alpha + \rho D_i + \sum_{j=1}^5 \beta_j R_i^j + \sum_{k=1}^5 \gamma_k D_i \cdot R_i^k + \varepsilon_i\)</span></p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-30-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="lateの推定値" class="slide level2">
<h2>LATEの推定値</h2>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-31-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="モデルの適合度" class="slide level2">
<h2>モデルの適合度</h2>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-32-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="ノンパラメトリック推定" class="slide level2">
<h2>ノンパラメトリック推定</h2>
<h3 id="パラメトリックのデメリット">パラメトリックのデメリット</h3>
<ul>
<li>結果変数と割当変数間の関数形の特定が重要
<ul>
<li>線形? 非線形（2次? 3次? 4次?）? 交差項?</li>
</ul></li>
<li>関数形の誤設定（misspecification）はバイアスの原因</li>
</ul>
<p><br></p>
<h3 id="ノンパラメトリック推定-1">ノンパラメトリック推定</h3>
<ul>
<li><strong>閾値周辺の個体のみを対象</strong>とし、処置群と統制群間の結果変数の平均値の差を比較
<ul>
<li><span class="math inline">\(c - h \leq R \leq c + h\)</span>の個体のみ使用（<span class="math inline">\(h\)</span>は<strong>バンド幅</strong>（bandwidth）と呼ばれる）</li>
</ul></li>
<li>2つの推定方法
<ul>
<li><span class="alert"><strong>局所平均</strong></span>（単純平均であるため、結果変数と割当変数間の関数形の特定が不要）</li>
<li><span class="alert"><strong>局所線形回帰分析</strong></span>（local linear regression）
<ul>
<li>現時点の主流であり、関数形の特定は必要だが、誤設定の影響が小さい。</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="局所平均" class="slide level2">
<h2>局所平均</h2>
<ul>
<li>全体平均の<span class="math inline">\(\widehat{\textsf{LATE}}\)</span>：<span class="math inline">\(\mathbb{E}[Y | c \leq R] - \mathbb{E}[Y | R &lt; c]\)</span></li>
<li>局所平均の<span class="math inline">\(\widehat{\textsf{LATE}}\)</span>：<span class="math inline">\(\mathbb{E}[Y | c \leq R \leq c + h] - \mathbb{E}[Y | c - h \leq R &lt; c]\)</span></li>
<li><span class="alert"><strong>カーネル関数を使用した加重平均</strong></span>（Nadaraya-Watson推定量）
<ul>
<li>重みなし平均も一様<span class="small">(uniform)</span>カーネル関数<sup>1</sup>に基づく加重平均</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-33-1.png" class="quarto-figure quarto-figure-center" width="2400"></p>
</figure>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn4"><p>長方形（rectangular）カーネル関数とも呼ばれる。</p></li></ol></aside></section>
<section id="バンド幅" class="slide level2">
<h2>バンド幅</h2>
<ul>
<li>最適なバンド幅を決めるたった一つのルールは存在しない
<ul>
<li><a href="https://doi.org/10.3386/w14726">Imbens and Kalyanaraman（2009）</a>、<a href="https://doi.org/10.1257/jel.48.2.281">Lee and Lemieux（2010）</a>、<a href="https://doi.org/10.1093/restud/rdr043">Imbens and Kalyanaraman（2012）</a>、<a href="https://doi.org/10.3982/ECTA11757">Calonico et al.（2014）</a>、<a href="https://doi.org/10.3982/QE590">Arai and Ichimura（2018）</a>、<a href="https://doi.org/10.3150/21-BEJ1445">Calonico et al.（2019）</a>、<a href="https://doi.org/10.1093/ectj/utz022">Calonico et al.（2020）</a>など
<ul>
<li>多くはMSE（mean squared error）の最小化を目指している。</li>
</ul></li>
<li>現在、一般的に採用されているのは<span class="alert"><strong>Imbens and Kalyanaraman（2012）</strong></span>の方法</li>
</ul></li>
</ul>
<p><br></p>
<ul>
<li>バンド幅によってLATEの推定値は変わる。
<ul>
<li>多少の変動は仕方ないが、バンド幅が少し変わっただけでLATEの推定値が大きく変化することは望ましくない。</li>
<li><span class="math inline">\(\Rightarrow\)</span> <span class="alert"><strong>感度分析</strong></span>（sensitivity analysis）を推奨
<ul>
<li>バンド幅を最適バンド幅を中心に少しずつ（前後に）動かしながらLATEの推定値の変化を示す</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="局所回帰分析" class="slide level2">
<h2>局所回帰分析</h2>
<p>ハンド幅内の個体のみを用いたパラメトリック推定法<span class="small">（<a href="https://doi.org/10.1111/1468-0262.00183">Hahn, Todd, and van der Klaauw 2001</a>）</span></p>
<ul>
<li>「線形+交差項」か「二次多項式+交差項」で十分な場合が多い</li>
</ul>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-34-1.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-34-2.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-34-3.png" class="quarto-figure quarto-figure-center" width="900"></p>
</figure>
</div>
</div>
</div>
</div>

<aside><div>
<ul>
<li>Hahn, Jinyong, Petra Todd, and Wilbert Van der Klaauw. 2001. “<a href="https://doi.org/10.1111/1468-0262.00183">Identification and Estimation of Treatment Effects with a Regression-Discontinuity Design</a>.” <em>Econometrica,</em> 69 (1): 201-209.</li>
</ul>
</div></aside></section>
<section id="局所平均と局所回帰" class="slide level2">
<h2>局所平均と局所回帰</h2>
<ul>
<li><strong>境界問題</strong>によるバイアスの発生<span class="small">（<a href="https://doi.org/10.1111/1468-0262.00183">Hahn, Todd, and van der Klaauw 2001</a>）</span>
<ul>
<li>以下の例は長方形カーネル関数に基づく局所平均</li>
</ul></li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-35-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="カーネル関数" class="slide level2">
<h2>カーネル関数</h2>
<p>閾値における処置効果に興味があるため、<span class="alert"><strong>閾値に近い個体ほど高い重み</strong></span>を付ける</p>
<ul>
<li>バンド幅外の個体には重み0を付ける</li>
<li>重み付けのルール：<span class="alert"><strong>カーネル関数</strong></span>（kernel function）
<ul>
<li><strong>一様/長方形</strong>カーネル関数：すべての個体の重みが同じ（=重み付けなし）</li>
<li><strong>三角形</strong>カーネル関数：LATE推定に最適なカーネル関数（<a href="https://amzn.asia/d/i5vsRUg">Fan and Gijbels 1996</a>）</li>
<li>ほとんどのパッケージは三角形カーネル関数がデフォルト</li>
</ul></li>
<li>カーネル関数が推定値に与える影響は限定的（<a href="https://doi.org/10.1257/jel.48.2.281">Lee and Lemieux 2010</a>）</li>
</ul>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-36-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section>
<section id="様々なカーネル関数" class="slide level2">
<h2>様々なカーネル関数</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/rdd/Kernels.svg" class="quarto-figure quarto-figure-center" style="width:75.0%"></p>
</figure>
</div>

<aside><div>
<p>出典：<a href="https://en.wikipedia.org/wiki/Kernel_(statistics)">Wikipedia</a></p>
</div></aside></section></section>
<section>
<section id="実装例" class="title-slide slide level1 center">
<h1><strong>4</strong> 実装例</h1>

</section>
<section id="推定パッケージ" class="slide level2">
<h2>推定（パッケージ）</h2>
<p>パッケージによってバンド幅、局所回帰分析の関数形、標準誤差の計算方法が異なるので、事前に確認しておくこと。</p>
<ul>
<li>推定用
<ul>
<li>{<a href="https://cran.r-project.org/web/packages/rdd/">rdd</a>}</li>
<li>{<a href="https://rdpackages.github.io/rdrobust/">rdrobust</a>}</li>
<li>{<a href="https://www.felixthoemmes.com/rddapp/">rddapp</a>}：推定 + ツールボックス</li>
<li>{<a href="https://cran.r-project.org/web/packages/SpatialRDD/index.html">SpatialRDD</a>}：地理的RDD</li>
</ul></li>
<li>ツールボックス系
<ul>
<li>{<a href="https://cran.r-project.org/web/packages/rddtools/">rddtools</a>}</li>
<li>{<a href="https://rdpackages.github.io/rddensity/">rddensity</a>}</li>
</ul></li>
</ul>
</section>
<section id="可視化散布図" class="slide level2">
<h2>可視化（散布図）</h2>
<ul>
<li>方法1：割当変数と結果変数の散布図（左）
<ul>
<li>個体が多い場合、傾向が読み取りにくい。</li>
</ul></li>
<li>方法2：割当変数の<strong>区間</strong>と結果変数の<strong>平均値</strong>の散布図（右）</li>
</ul>
<div class="cell quarto-layout-panel" data-layout-align="center" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-37-1.png" class="quarto-figure quarto-figure-center" width="1500"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-37-2.png" class="quarto-figure quarto-figure-center" width="1500"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="感度分析" class="slide level2">
<h2>感度分析</h2>
<p><strong>バンド幅</strong>（左）と<strong>高次多項式</strong>（右）の感度分析の例</p>
<ul>
<li>以下は<a href="https://doi.org/10.1016/j.electstud.2016.03.006">Ariga et al.（2016）</a>の例（Figure 2の一部）</li>
</ul>
<p><img data-src="figs/rdd/ariga_2016.png"></p>

<aside><div>
<p>Ariga, Kenichi, Yusaku Horiuchi, Roland Mansilla, and Michio Umeda. 2016. “<a href="https://doi.org/10.1016/j.electstud.2016.03.006">No sorting, no advantage: Regression discontinuity estimates of incumbency advantage in Japan</a>.” <em>Electoral Studies</em>, 43: 21-31.</p>
</div></aside></section>
<section id="プラセボ検定" class="slide level2">
<h2>プラセボ検定</h2>
<p><a href="https://doi.org/10.1016/j.jeconom.2007.05.001">Imbens and Lemieux（2008）</a>のガイドライン</p>
<ol type="1">
<li>閾値を基準とし、左右でサンプルを分割する。</li>
<li>それぞれのサブサンプルにおける<span class="math inline">\(R\)</span>の<span class="math inline">\(\delta\)</span>分位数をを求める。
<ul>
<li>閾値左側サンプルにおける<span class="math inline">\(R\)</span>の<span class="math inline">\(\delta\)</span>分位数：<span class="math inline">\(q_{R, \delta, l}\)</span></li>
<li>閾値右側サンプルにおける<span class="math inline">\(R\)</span>の<span class="math inline">\(\delta\)</span>分位数：<span class="math inline">\(q_{R, \delta, r}\)</span></li>
<li>中央値を<span class="math inline">\(\delta\)</span>とする場合、それぞれ<span class="math inline">\(q_{R, 1/2, l}\)</span>と<span class="math inline">\(q_{R, 1/2, r}\)</span></li>
</ul></li>
<li><span class="math inline">\(q_{R, \delta, l}\)</span>と<span class="math inline">\(q_{R, \delta, r}\)</span>をサブサンプルにおける閾値とする。</li>
<li>各サブサンプル内でRDDを推定する。
<ul>
<li><span class="math inline">\(\delta=0.5\)</span>に加え、別の<span class="math inline">\(\delta\)</span>を採用しても良い。</li>
</ul></li>
</ol>

<aside><div>
<p>注：<a href="https://doi.org/10.1016/j.jeconom.2007.05.001">Imbens and Lemieux（2008）</a>は割当変数を<span class="math inline">\(X\)</span>と表記しているため、<span class="math inline">\(q_{X, \delta, l}\)</span>、<span class="math inline">\(q_{X, \delta, l}\)</span>と表記している。</p>
</div></aside></section>
<section id="プラセボ検定の例" class="slide level2">
<h2>プラセボ検定の例</h2>
<p>新しい閾値周辺においてジャンプが生じない（=LATEの推定値が0）ことが望ましい。</p>

<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-38-1.png" class="quarto-figure quarto-figure-center r-stretch" width="2400"></section>
<section id="バランスチェック" class="slide level2">
<h2>バランスチェック</h2>
<p>共変量（処置前変数）を結果変数とし、RDDを実行</p>
<ul>
<li>ジャンプが生じないことが望ましい</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/rdd/balance_check.png" class="quarto-figure quarto-figure-center" style="width:65.0%"></p>
</figure>
</div>

<aside><div>
<p>出典：<a href="https://doi.org/10.1162/0033553041502153">Lee, Moretti, and Butler（2004）</a></p>
</div></aside></section>
<section id="密度検定" class="slide level2">
<h2>密度検定</h2>
<ul>
<li><span class="math inline">\(H_0\)</span>：閾値周辺において割当変数の操作が行われていない。</li>
</ul>



<img data-src="rdd_slide_files/figure-revealjs/unnamed-chunk-40-1.png" class="quarto-figure quarto-figure-center r-stretch" width="1800"></section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>回帰不連続デザイン</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1200,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "コピーしました");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "コピーしました");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // target, if specified
                link.setAttribute("target", "_blank");
                if (link.getAttribute("rel") === null) {
                  link.setAttribute("rel", "noopener");
                }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>